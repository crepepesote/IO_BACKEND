<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Simulator - An√°lisis de Colas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #1e40af 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        @media (hover: hover) {
            .card-hover:hover {
                transform: translateY(-4px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            }
        }
        .loading-spinner {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .metric-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .stat-badge {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        .chart-container-sm {
            position: relative;
            height: 250px;
        }
        @media (max-width: 640px) {
            .chart-container-sm {
                height: 200px;
            }
        }
        .theoretical-section {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        .empirical-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }
        .procedure-section {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
        }
        .equation {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border-left: 3px solid #f59e0b;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        .equation-step {
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0.375rem;
        }
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .tab-button {
                font-size: 0.875rem;
                padding: 0.75rem 1rem;
            }
            h1 {
                font-size: 1.875rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            h3 {
                font-size: 1.25rem;
            }
        }
        /* Prevent horizontal scroll */
        body {
            overflow-x: hidden;
        }
        /* Touch targets for mobile */
        @media (max-width: 640px) {
            button, input, select, textarea {
                min-height: 44px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-4 py-6 sm:py-8">
            <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold tracking-tight">Queue Simulator</h1>
            <p class="text-blue-100 mt-2 text-sm sm:text-base md:text-lg">An√°lisis de Sistemas de Colas M/G/1, G/M/1, G/G/1, M/G/C</p>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container mx-auto px-3 sm:px-4 py-6 sm:py-8 max-w-7xl">
        <!-- Input Section -->
        <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 mb-6 sm:mb-8 border border-gray-100">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">Configuraci√≥n de Simulaci√≥n</h2>
            
            <!-- Tabs -->
            <div class="flex border-b border-gray-200 mb-4 sm:mb-6 overflow-x-auto">
                <button id="tab-manual" class="tab-button px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base font-semibold border-b-2 border-blue-600 text-blue-600 transition-colors whitespace-nowrap">
                    Manual
                </button>
                <button id="tab-text" class="tab-button px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base font-semibold text-gray-500 hover:text-gray-700 transition-colors whitespace-nowrap">
                    Desde Texto (IA)
                </button>
            </div>

            <!-- Manual Input -->
            <div id="panel-manual" class="tab-panel">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Tasa de Llegada (Œª)</label>
                        <input type="number" id="arrival_rate" value="5" step="0.1" 
                               class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Tipo de Llegada</label>
                        <select id="arrival_type" class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <option value="exponential">Exponencial</option>
                            <option value="uniform">Uniforme</option>
                            <option value="deterministic">Determin√≠stica</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Tasa de Servicio (Œº)</label>
                        <input type="number" id="service_rate" value="8" step="0.1"
                               class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Tipo de Servicio</label>
                        <select id="service_type" class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <option value="exponential">Exponencial</option>
                            <option value="normal">Normal</option>
                            <option value="uniform">Uniforme</option>
                            <option value="deterministic">Determin√≠stica</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">N√∫mero de Servidores</label>
                        <input type="number" id="num_servers" value="1" min="1" max="10"
                               class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Clientes a Simular</label>
                        <input type="number" id="num_customers" value="1000" min="100" max="50000" step="100"
                               class="w-full px-3 sm:px-4 py-2 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    </div>
                </div>
                <button onclick="runSimulation()" class="mt-4 sm:mt-6 w-full md:w-auto px-6 sm:px-8 py-2.5 sm:py-3 text-sm sm:text-base bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200 shadow-lg hover:shadow-xl">
                    Ejecutar Simulaci√≥n
                </button>
            </div>

            <!-- Text Input -->
            <div id="panel-text" class="tab-panel hidden">
                <textarea id="problem_text" rows="4" 
                          placeholder="Ejemplo: Simular un sistema de colas con tasa de llegada de 5 clientes/hora, tasa de servicio de 8 clientes/hora, 1 servidor, para 1000 clientes."
                          class="w-full px-3 sm:px-4 py-3 text-sm sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"></textarea>
                <button onclick="runTextSimulation()" class="mt-4 w-full md:w-auto px-6 sm:px-8 py-2.5 sm:py-3 text-sm sm:text-base bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-200 shadow-lg hover:shadow-xl">
                    Analizar con IA
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden flex justify-center items-center py-12">
            <div class="text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600 font-medium">Ejecutando simulaci√≥n...</p>
            </div>
        </div>

        <!-- Error Message -->
        <div id="error" class="hidden bg-red-50 border-l-4 border-red-500 p-3 sm:p-4 mb-6 sm:mb-8 rounded-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-xs sm:text-sm font-medium text-red-800">Error</h3>
                    <p id="error-message" class="text-xs sm:text-sm text-red-700 mt-1"></p>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <!-- Comparison Chart -->
            <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 mb-6 sm:mb-8 border border-gray-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Comparaci√≥n de Modelos</h2>
                <canvas id="comparisonChart" class="w-full" height="100"></canvas>
            </div>

            <!-- Model Cards Grid -->
            <div id="model-cards" class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                <!-- Cards will be inserted here -->
            </div>

            <!-- Detailed Charts Section -->
            <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 mb-6 sm:mb-8 border border-gray-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">An√°lisis Gr√°fico Detallado por Modelo</h2>
                <div id="detailed-charts">
                    <!-- Detailed charts will be inserted here -->
                </div>
            </div>

            <!-- Comparison Charts Section -->
            <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 mb-6 sm:mb-8 border border-gray-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6">Comparaciones Avanzadas</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                        <h3 class="text-sm sm:text-lg font-semibold text-gray-700 mb-3">Utilizaci√≥n del Sistema (œÅ)</h3>
                        <div class="chart-container-sm">
                            <canvas id="comparisonRho"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                        <h3 class="text-sm sm:text-lg font-semibold text-gray-700 mb-3">Clientes en Sistema (L)</h3>
                        <div class="chart-container-sm">
                            <canvas id="comparisonL"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                        <h3 class="text-sm sm:text-lg font-semibold text-gray-700 mb-3">Tiempo en Sistema (W)</h3>
                        <div class="chart-container-sm">
                            <canvas id="comparisonW"></canvas>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                        <h3 class="text-sm sm:text-lg font-semibold text-gray-700 mb-3">Te√≥rico vs Emp√≠rico (W)</h3>
                        <div class="chart-container-sm">
                            <canvas id="comparisonTheoretical"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Metrics Table -->
            <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 border border-gray-100">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">M√©tricas Detalladas</h2>
                <div class="overflow-x-auto -mx-4 sm:mx-0">
                    <div class="inline-block min-w-full align-middle">
                        <table class="min-w-full text-xs sm:text-sm text-left">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th class="px-3 sm:px-6 py-3 font-semibold">M√©trica</th>
                                    <th class="px-3 sm:px-6 py-3 font-semibold">M/G/1</th>
                                    <th class="px-3 sm:px-6 py-3 font-semibold">G/M/1</th>
                                    <th class="px-3 sm:px-6 py-3 font-semibold">G/G/1</th>
                                    <th class="px-3 sm:px-6 py-3 font-semibold">M/G/C</th>
                                </tr>
                            </thead>
                            <tbody id="metrics-table-body">
                                <!-- Rows will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white mt-8 sm:mt-12 py-4 sm:py-6 border-t border-blue-900">
        <div class="container mx-auto px-4 text-center">
            <p class="text-blue-100 text-xs sm:text-sm">Queue Simulator v1.2.0 | Teor√≠a de Colas</p>
        </div>
    </footer>

    <script>
        const API_URL = 'http://localhost:8000';
        let comparisonChart = null;
        let allCharts = {};

        // Tab switching
        document.getElementById('tab-manual').addEventListener('click', () => {
            document.getElementById('tab-manual').classList.add('border-blue-600', 'text-blue-600');
            document.getElementById('tab-manual').classList.remove('text-gray-500');
            document.getElementById('tab-text').classList.remove('border-blue-600', 'text-blue-600');
            document.getElementById('tab-text').classList.add('text-gray-500');
            document.getElementById('panel-manual').classList.remove('hidden');
            document.getElementById('panel-text').classList.add('hidden');
        });

        document.getElementById('tab-text').addEventListener('click', () => {
            document.getElementById('tab-text').classList.add('border-blue-600', 'text-blue-600');
            document.getElementById('tab-text').classList.remove('text-gray-500');
            document.getElementById('tab-manual').classList.remove('border-blue-600', 'text-blue-600');
            document.getElementById('tab-manual').classList.add('text-gray-500');
            document.getElementById('panel-text').classList.remove('hidden');
            document.getElementById('panel-manual').classList.add('hidden');
        });

        async function runSimulation() {
            showLoading();
            hideError();

            const params = {
                arrival_rate: parseFloat(document.getElementById('arrival_rate').value),
                arrival_type: document.getElementById('arrival_type').value,
                service_rate: parseFloat(document.getElementById('service_rate').value),
                service_type: document.getElementById('service_type').value,
                num_servers: parseInt(document.getElementById('num_servers').value),
                num_customers: parseInt(document.getElementById('num_customers').value),
                seed: 42
            };

            try {
                const response = await fetch(`${API_URL}/simulate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });

                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    showError(data.error || 'Error desconocido en la simulaci√≥n');
                }
            } catch (error) {
                showError(`Error de conexi√≥n: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        async function runTextSimulation() {
            showLoading();
            hideError();

            const problemText = document.getElementById('problem_text').value;

            if (!problemText.trim()) {
                showError('Por favor ingrese un enunciado');
                hideLoading();
                return;
            }

            try {
                const response = await fetch(`${API_URL}/simulate-from-text`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ problem_text: problemText })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    showError(data.error || 'No se pudieron extraer par√°metros del texto');
                }
            } catch (error) {
                showError(`Error de conexi√≥n: ${error.message}`);
            } finally {
                hideLoading();
            }
        }

        function displayResults(data) {
            console.log('Datos recibidos:', data);
            
            if (!data || !data.results || data.results.length === 0) {
                showError('No se recibieron resultados de la simulaci√≥n');
                return;
            }

            document.getElementById('results').classList.remove('hidden');
            
            // Display model cards
            const modelCardsContainer = document.getElementById('model-cards');
            modelCardsContainer.innerHTML = '';

            data.results.forEach(model => {
                const card = createModelCard(model);
                modelCardsContainer.appendChild(card);
            });

            // Create comparison chart
            createComparisonChart(data.results);

            // Create detailed charts for each model
            createDetailedCharts(data.results);

            // Create comparison charts
            createAdvancedComparisonCharts(data.results);

            // Create metrics table
            createMetricsTable(data.results);

            // Scroll to results
            setTimeout(() => {
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function createModelCard(model) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl shadow-xl p-4 sm:p-6 card-hover border border-gray-100';

            const metrics = model.metrics;
            const empirical = model.empirical || {};
            const theoretical = model.theoretical || {};

            // Generate procedure HTML
            const procedureHTML = generateProcedureHTML(model);

            let theoreticalHTML = '';
            if (Object.keys(theoretical).length > 0) {
                theoreticalHTML = '<div class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-200 theoretical-section rounded-lg p-3 sm:p-4">';
                theoreticalHTML += '<p class="text-xs sm:text-sm font-semibold text-blue-700 mb-2 sm:mb-3">M√©tricas Te√≥ricas</p>';
                theoreticalHTML += '<div class="grid grid-cols-2 gap-2 text-xs">';
                
                for (const [key, value] of Object.entries(theoretical)) {
                    if (typeof value === 'object' && value !== null) {
                        theoreticalHTML += `<div class="col-span-2 mb-2"><span class="font-semibold text-blue-600">${key}:</span></div>`;
                        for (const [subkey, subval] of Object.entries(value)) {
                            if (typeof subval === 'number') {
                                theoreticalHTML += `<div class="text-gray-700">${subkey}:</div><div class="font-semibold text-gray-900">${subval.toFixed(4)}</div>`;
                            }
                        }
                    }
                }
                theoreticalHTML += '</div></div>';
            }

            let empiricalHTML = '';
            if (Object.keys(empirical).length > 0) {
                empiricalHTML = '<div class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-gray-200 empirical-section rounded-lg p-3 sm:p-4">';
                empiricalHTML += '<p class="text-xs sm:text-sm font-semibold text-green-700 mb-2 sm:mb-3">M√©tricas Emp√≠ricas</p>';
                empiricalHTML += '<div class="grid grid-cols-2 gap-2 text-xs text-gray-700">';
                
                const displayKeys = ['W_emp', 'Wq_emp', 'W_p50', 'W_p90', 'W_p99', 'Wq_p50', 'Wq_p90', 'Wq_p99', 'L_time_avg', 'Lq_time_avg'];
                displayKeys.forEach(key => {
                    if (empirical[key] !== undefined) {
                        empiricalHTML += `<div>${key}:</div><div class="font-semibold text-gray-900">${empirical[key].toFixed(4)}</div>`;
                    }
                });
                empiricalHTML += '</div></div>';
            }

            const modelId = model.model_name.replace(/\//g, '_').replace(/\s/g, '_');

            card.innerHTML = `
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 sm:mb-4 gap-2">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800">${model.model_name}</h3>
                    <span class="stat-badge text-white text-xs px-2 sm:px-3 py-1 rounded-full font-semibold whitespace-nowrap">
                        œÅ = ${metrics.rho?.toFixed(3) || 'N/A'} ${metrics.rho >= 1 ? 'Inestable' : 'Estable'}
                    </span>
                </div>

                <button onclick="toggleProcedure('${modelId}')" 
                        class="mb-3 w-full sm:w-auto px-4 py-2 bg-amber-500 text-white text-sm font-semibold rounded-lg hover:bg-amber-600 transition duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Ver Procedimiento Matem√°tico
                </button>

                <div id="procedure-${modelId}" class="hidden procedure-section rounded-lg p-4 mb-4 border-2 border-amber-300">
                    ${procedureHTML}
                </div>
                
                <div class="grid grid-cols-2 gap-2 sm:gap-3 mb-3 sm:mb-4">
                    <div class="metric-card p-3 sm:p-4 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-600 mb-1">Utilizaci√≥n (œÅ)</p>
                        <p class="text-base sm:text-xl font-bold text-blue-600">${metrics.rho?.toFixed(4) || 'N/A'}</p>
                    </div>
                    <div class="metric-card p-3 sm:p-4 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-600 mb-1">En Sistema (L)</p>
                        <p class="text-base sm:text-xl font-bold text-indigo-600">${metrics.L?.toFixed(4) || 'N/A'}</p>
                    </div>
                    <div class="metric-card p-3 sm:p-4 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-600 mb-1">En Cola (Lq)</p>
                        <p class="text-base sm:text-xl font-bold text-cyan-600">${metrics.Lq?.toFixed(4) || 'N/A'}</p>
                    </div>
                    <div class="metric-card p-3 sm:p-4 rounded-lg border border-gray-200">
                        <p class="text-xs text-gray-600 mb-1">Tiempo Total (W)</p>
                        <p class="text-base sm:text-xl font-bold text-teal-600">${metrics.W?.toFixed(4) || 'N/A'}</p>
                    </div>
                </div>

                ${model.plot_base64 ? `
                    <div class="mt-3 sm:mt-4">
                        <img src="data:image/png;base64,${model.plot_base64}" alt="Gr√°fico ${model.model_name}" class="w-full rounded-lg shadow-md border border-gray-200">
                    </div>
                ` : ''}

                ${theoreticalHTML}
                ${empiricalHTML}
            `;

            return card;
        }

        function generateProcedureHTML(model) {
            const m = model.metrics;
            const modelName = model.model_name;
            
            let html = '<div class="space-y-4">';
            html += '<h4 class="text-base sm:text-lg font-bold text-amber-800 mb-3">üìã Procedimiento de C√°lculo</h4>';
            
            // Par√°metros de entrada
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">1Ô∏è‚É£ Par√°metros de Entrada:</p>';
            html += '<div class="equation">';
            html += `<p>Œª (Tasa de llegada) = ${m.lambda?.toFixed(4) || 'N/A'} clientes/unidad de tiempo</p>`;
            html += `<p>Œº (Tasa de servicio) = ${m.mu?.toFixed(4) || 'N/A'} clientes/unidad de tiempo</p>`;
            html += `<p>c (N√∫mero de servidores) = ${m.c || 1}</p>`;
            html += '</div></div>';

            // C√°lculo de œÅ
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">2Ô∏è‚É£ Factor de Utilizaci√≥n (œÅ):</p>';
            html += '<div class="equation">';
            if (m.c && m.c > 1) {
                html += `<p>œÅ = Œª / (c √ó Œº)</p>`;
                html += `<p>œÅ = ${m.lambda?.toFixed(4)} / (${m.c} √ó ${m.mu?.toFixed(4)})</p>`;
                html += `<p><strong>œÅ = ${m.rho?.toFixed(4)}</strong></p>`;
            } else {
                html += `<p>œÅ = Œª / Œº</p>`;
                html += `<p>œÅ = ${m.lambda?.toFixed(4)} / ${m.mu?.toFixed(4)}</p>`;
                html += `<p><strong>œÅ = ${m.rho?.toFixed(4)}</strong></p>`;
            }
            html += `<p class="mt-2 text-sm ${m.rho >= 1 ? 'text-red-600' : 'text-green-600'}">`;
            html += m.rho >= 1 ? '‚ö†Ô∏è Sistema INESTABLE (œÅ ‚â• 1)' : '‚úÖ Sistema ESTABLE (œÅ < 1)';
            html += '</p></div></div>';

            // Modelo espec√≠fico
            if (modelName === 'M/M/1' || modelName.includes('M/G/1')) {
                html += generateMGProcedure(m);
            } else if (modelName.includes('G/M/1')) {
                html += generateGMProcedure(m);
            } else if (modelName.includes('G/G/1')) {
                html += generateGGProcedure(m);
            } else if (modelName.includes('M/G/C') || modelName.includes('M/M/C')) {
                html += generateMGCProcedure(m);
            }

            html += '</div>';
            return html;
        }

        function generateMGProcedure(m) {
            let html = '';
            
            // L
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">3Ô∏è‚É£ N√∫mero promedio de clientes en el sistema (L):</p>';
            html += '<div class="equation">';
            html += '<p>L = œÅ / (1 - œÅ)</p>';
            html += `<p>L = ${m.rho?.toFixed(4)} / (1 - ${m.rho?.toFixed(4)})</p>`;
            html += `<p>L = ${m.rho?.toFixed(4)} / ${(1 - m.rho)?.toFixed(4)}</p>`;
            html += `<p><strong>L = ${m.L?.toFixed(4)} clientes</strong></p>`;
            html += '</div></div>';

            // Lq
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">4Ô∏è‚É£ N√∫mero promedio de clientes en la cola (Lq):</p>';
            html += '<div class="equation">';
            html += '<p>Lq = œÅ¬≤ / (1 - œÅ)</p>';
            html += `<p>Lq = ${m.rho?.toFixed(4)}¬≤ / (1 - ${m.rho?.toFixed(4)})</p>`;
            html += `<p>Lq = ${(m.rho * m.rho)?.toFixed(4)} / ${(1 - m.rho)?.toFixed(4)}</p>`;
            html += `<p><strong>Lq = ${m.Lq?.toFixed(4)} clientes</strong></p>`;
            html += '</div></div>';

            // W
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">5Ô∏è‚É£ Tiempo promedio en el sistema (W):</p>';
            html += '<div class="equation">';
            html += '<p>W = 1 / (Œº - Œª)</p>';
            html += `<p>W = 1 / (${m.mu?.toFixed(4)} - ${m.lambda?.toFixed(4)})</p>`;
            html += `<p>W = 1 / ${(m.mu - m.lambda)?.toFixed(4)}</p>`;
            html += `<p><strong>W = ${m.W?.toFixed(4)} unidades de tiempo</strong></p>`;
            html += '</div></div>';

            // Wq
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">6Ô∏è‚É£ Tiempo promedio en la cola (Wq):</p>';
            html += '<div class="equation">';
            html += '<p>Wq = œÅ / (Œº - Œª)</p>';
            html += `<p>Wq = ${m.rho?.toFixed(4)} / (${m.mu?.toFixed(4)} - ${m.lambda?.toFixed(4)})</p>`;
            html += `<p>Wq = ${m.rho?.toFixed(4)} / ${(m.mu - m.lambda)?.toFixed(4)}</p>`;
            html += `<p><strong>Wq = ${m.Wq?.toFixed(4)} unidades de tiempo</strong></p>`;
            html += '</div></div>';

            return html;
        }

        function generateGMProcedure(m) {
            let html = '';
            
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">3Ô∏è‚É£ Modelo G/M/1 - Aproximaciones:</p>';
            html += '<div class="equation">';
            html += '<p>Para G/M/1, las f√≥rmulas exactas dependen del coeficiente de variaci√≥n de las llegadas.</p>';
            html += '<p>Se utilizan aproximaciones basadas en la f√≥rmula de Kingman.</p>';
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">4Ô∏è‚É£ Tiempo promedio en cola (Wq):</p>';
            html += '<div class="equation">';
            html += '<p>Wq ‚âà (œÅ / Œª) √ó [œÅ / (2(1 - œÅ))]</p>';
            html += `<p><strong>Wq ‚âà ${m.Wq?.toFixed(4)} unidades de tiempo</strong></p>`;
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">5Ô∏è‚É£ Otras m√©tricas (Ley de Little):</p>';
            html += '<div class="equation">';
            html += `<p>W = Wq + 1/Œº</p>`;
            html += `<p>W = ${m.Wq?.toFixed(4)} + ${(1/m.mu)?.toFixed(4)} = <strong>${m.W?.toFixed(4)}</strong></p>`;
            html += `<p class="mt-2">L = Œª √ó W = ${m.lambda?.toFixed(4)} √ó ${m.W?.toFixed(4)} = <strong>${m.L?.toFixed(4)}</strong></p>`;
            html += `<p>Lq = Œª √ó Wq = ${m.lambda?.toFixed(4)} √ó ${m.Wq?.toFixed(4)} = <strong>${m.Lq?.toFixed(4)}</strong></p>`;
            html += '</div></div>';

            return html;
        }

        function generateGGProcedure(m) {
            let html = '';
            
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">3Ô∏è‚É£ Modelo G/G/1 - Aproximaci√≥n de Kingman:</p>';
            html += '<div class="equation">';
            html += '<p>Para distribuciones generales, usamos la f√≥rmula de Kingman:</p>';
            html += '<p>Wq ‚âà (Ca¬≤ + Cs¬≤) / 2 √ó [œÅ / (1 - œÅ)] √ó (1 / Œº)</p>';
            html += '<p>Donde:</p>';
            html += '<p>‚Ä¢ Ca¬≤ = coeficiente de variaci√≥n al cuadrado de las llegadas</p>';
            html += '<p>‚Ä¢ Cs¬≤ = coeficiente de variaci√≥n al cuadrado del servicio</p>';
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">4Ô∏è‚É£ Tiempo en cola aproximado (Wq):</p>';
            html += '<div class="equation">';
            html += `<p><strong>Wq ‚âà ${m.Wq?.toFixed(4)} unidades de tiempo</strong></p>`;
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">5Ô∏è‚É£ M√©tricas derivadas (Ley de Little):</p>';
            html += '<div class="equation">';
            html += `<p>W = Wq + 1/Œº</p>`;
            html += `<p>W = ${m.Wq?.toFixed(4)} + ${(1/m.mu)?.toFixed(4)} = <strong>${m.W?.toFixed(4)}</strong></p>`;
            html += `<p class="mt-2">L = Œª √ó W = ${m.lambda?.toFixed(4)} √ó ${m.W?.toFixed(4)} = <strong>${m.L?.toFixed(4)}</strong></p>`;
            html += `<p>Lq = Œª √ó Wq = ${m.lambda?.toFixed(4)} √ó ${m.Wq?.toFixed(4)} = <strong>${m.Lq?.toFixed(4)}</strong></p>`;
            html += '</div></div>';

            return html;
        }

        function generateMGCProcedure(m) {
            let html = '';
            
            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">3Ô∏è‚É£ Modelo M/G/C - M√∫ltiples servidores:</p>';
            html += '<div class="equation">';
            html += `<p>Sistema con c = ${m.c} servidores</p>`;
            html += `<p>œÅ = Œª / (c √ó Œº) = ${m.lambda?.toFixed(4)} / (${m.c} √ó ${m.mu?.toFixed(4)}) = ${m.rho?.toFixed(4)}</p>`;
            html += '<p class="mt-2">Este modelo requiere c√°lculos m√°s complejos usando:</p>';
            html += '<p>‚Ä¢ F√≥rmula C de Erlang para m√∫ltiples servidores</p>';
            html += '<p>‚Ä¢ Probabilidad de que todos los servidores est√©n ocupados</p>';
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">4Ô∏è‚É£ C√°lculo de probabilidades:</p>';
            html += '<div class="equation">';
            html += '<p>P(espera) se calcula considerando la probabilidad de que</p>';
            html += '<p>todos los servidores est√©n ocupados al llegar un cliente.</p>';
            html += '</div></div>';

            html += '<div class="equation-step">';
            html += '<p class="font-semibold text-gray-800 mb-2">5Ô∏è‚É£ M√©tricas del sistema:</p>';
            html += '<div class="equation">';
            html += `<p>L (clientes en sistema) = <strong>${m.L?.toFixed(4)}</strong></p>`;
            html += `<p>Lq (clientes en cola) = <strong>${m.Lq?.toFixed(4)}</strong></p>`;
            html += `<p>W (tiempo en sistema) = L / Œª = ${m.L?.toFixed(4)} / ${m.lambda?.toFixed(4)} = <strong>${m.W?.toFixed(4)}</strong></p>`;
            html += `<p>Wq (tiempo en cola) = Lq / Œª = ${m.Lq?.toFixed(4)} / ${m.lambda?.toFixed(4)} = <strong>${m.Wq?.toFixed(4)}</strong></p>`;
            html += '</div></div>';

            return html;
        }

        function toggleProcedure(modelId) {
            const element = document.getElementById(`procedure-${modelId}`);
            if (element) {
                element.classList.toggle('hidden');
            }
        }

        function createDetailedCharts(results) {
            const container = document.getElementById('detailed-charts');
            container.innerHTML = '';

            results.forEach((model, idx) => {
                // Destruir charts anteriores si existen
                if (allCharts[`timeSeries${idx}`]) allCharts[`timeSeries${idx}`].destroy();
                if (allCharts[`queueDist${idx}`]) allCharts[`queueDist${idx}`].destroy();
                if (allCharts[`boxPlot${idx}`]) allCharts[`boxPlot${idx}`].destroy();
                if (allCharts[`waitHist${idx}`]) allCharts[`waitHist${idx}`].destroy();

                const modelSection = document.createElement('div');
                modelSection.className = 'mb-8 pb-8 border-b border-gray-200 last:border-b-0';
                
                modelSection.innerHTML = `
                    <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4">${model.model_name}</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                            <h4 class="text-xs sm:text-sm font-semibold text-gray-700 mb-3">Evoluci√≥n Temporal</h4>
                            <div class="chart-container-sm">
                                <canvas id="timeSeries${idx}"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                            <h4 class="text-xs sm:text-sm font-semibold text-gray-700 mb-3">Distribuci√≥n Longitud de Cola</h4>
                            <div class="chart-container-sm">
                                <canvas id="queueDist${idx}"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                            <h4 class="text-xs sm:text-sm font-semibold text-gray-700 mb-3">Box Plot - Tiempos en Sistema</h4>
                            <div class="chart-container-sm">
                                <canvas id="boxPlot${idx}"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-3 sm:p-4">
                            <h4 class="text-xs sm:text-sm font-semibold text-gray-700 mb-3">Histograma - Tiempos de Espera</h4>
                            <div class="chart-container-sm">
                                <canvas id="waitHist${idx}"></canvas>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(modelSection);

                // Render charts for this model
                setTimeout(() => {
                    renderTimeSeriesChart(model, idx);
                    renderQueueDistChart(model, idx);
                    renderBoxPlotChart(model, idx);
                    renderWaitHistChart(model, idx);
                }, 100);
            });
        }

        function renderTimeSeriesChart(model, idx) {
            const ctx = document.getElementById(`timeSeries${idx}`).getContext('2d');
            const data = model.animation_data || [];
            
            allCharts[`timeSeries${idx}`] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((d, i) => i % 5 === 0 ? d.time.toFixed(1) : ''),
                    datasets: [{
                        label: 'En Sistema',
                        data: data.map(d => d.in_system),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    }, {
                        label: 'En Cola',
                        data: data.map(d => d.queue_length),
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            display: true, 
                            position: 'top',
                            labels: {
                                font: { size: window.innerWidth < 640 ? 10 : 12 },
                                boxWidth: window.innerWidth < 640 ? 15 : 40
                            }
                        } 
                    },
                    scales: {
                        x: { 
                            display: true, 
                            title: { 
                                display: true, 
                                text: 'Tiempo',
                                font: { size: window.innerWidth < 640 ? 10 : 12 }
                            },
                            ticks: {
                                font: { size: window.innerWidth < 640 ? 9 : 11 }
                            }
                        },
                        y: { 
                            beginAtZero: true, 
                            title: { 
                                display: true, 
                                text: 'Clientes',
                                font: { size: window.innerWidth < 640 ? 10 : 12 }
                            },
                            ticks: {
                                font: { size: window.innerWidth < 640 ? 9 : 11 }
                            }
                        }
                    }
                }
            });
        }

        function renderQueueDistChart(model, idx) {
            const ctx = document.getElementById(`queueDist${idx}`).getContext('2d');
            const data = model.animation_data || [];
            const queueLengths = data.map(d => d.queue_length);
            const distribution = {};
            
            queueLengths.forEach(len => {
                distribution[len] = (distribution[len] || 0) + 1;
            });

            allCharts[`queueDist${idx}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(distribution),
                    datasets: [{
                        label: 'Frecuencia',
                        data: Object.values(distribution),
                        backgroundColor: 'rgba(6, 182, 212, 0.7)',
                        borderColor: '#06b6d4',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: 'Longitud' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Frecuencia' } }
                    }
                }
            });
        }

        function renderBoxPlotChart(model, idx) {
            const ctx = document.getElementById(`boxPlot${idx}`).getContext('2d');
            const empirical = model.empirical || {};
            
            const boxData = [
                empirical.W_p50 * 0.3 || 0,
                empirical.W_p50 * 0.7 || 0,
                empirical.W_p50 || 0,
                empirical.W_p90 || 0,
                empirical.W_p99 || 0
            ];

            allCharts[`boxPlot${idx}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['M√≠n', 'Q1', 'Mediana', 'Q3', 'M√°x'],
                    datasets: [{
                        label: 'Tiempo en Sistema',
                        data: boxData,
                        backgroundColor: ['#4ecdc4', '#95e1d3', '#f38181', '#aa96da', '#c9ada7']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Tiempo' } }
                    }
                }
            });
        }

        function renderWaitHistChart(model, idx) {
            const ctx = document.getElementById(`waitHist${idx}`).getContext('2d');
            const empirical = model.empirical || {};
            
            const bins = [
                { label: '0-25%', value: empirical.Wq_p50 * 0.3 || 0 },
                { label: '25-50%', value: empirical.Wq_p50 * 0.7 || 0 },
                { label: '50-75%', value: empirical.Wq_p90 * 0.5 || 0 },
                { label: '75-90%', value: empirical.Wq_p90 * 0.8 || 0 },
                { label: '90-99%', value: empirical.Wq_p99 || 0 }
            ];

            allCharts[`waitHist${idx}`] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bins.map(b => b.label),
                    datasets: [{
                        label: 'Tiempo de Espera',
                        data: bins.map(b => b.value),
                        backgroundColor: 'rgba(168, 85, 247, 0.7)',
                        borderColor: '#a855f7',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { title: { display: true, text: 'Percentil' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Tiempo' } }
                    }
                }
            });
        }

        function createAdvancedComparisonCharts(results) {
            // Destruir charts anteriores si existen
            if (allCharts.comparisonRho) allCharts.comparisonRho.destroy();
            if (allCharts.comparisonL) allCharts.comparisonL.destroy();
            if (allCharts.comparisonW) allCharts.comparisonW.destroy();
            if (allCharts.comparisonTheoretical) allCharts.comparisonTheoretical.destroy();

            // Comparaci√≥n œÅ
            const ctxRho = document.getElementById('comparisonRho').getContext('2d');
            allCharts.comparisonRho = new Chart(ctxRho, {
                type: 'doughnut',
                data: {
                    labels: results.map(r => r.model_name),
                    datasets: [{
                        data: results.map(r => r.metrics.rho || 0),
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Comparaci√≥n L
            const ctxL = document.getElementById('comparisonL').getContext('2d');
            allCharts.comparisonL = new Chart(ctxL, {
                type: 'bar',
                data: {
                    labels: results.map(r => r.model_name),
                    datasets: [{
                        label: 'L (Clientes en Sistema)',
                        data: results.map(r => r.metrics.L || 0),
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: '#3b82f6',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Comparaci√≥n W
            const ctxW = document.getElementById('comparisonW').getContext('2d');
            allCharts.comparisonW = new Chart(ctxW, {
                type: 'bar',
                data: {
                    labels: results.map(r => r.model_name),
                    datasets: [{
                        label: 'W (Tiempo en Sistema)',
                        data: results.map(r => r.metrics.W || 0),
                        backgroundColor: 'rgba(139, 92, 246, 0.7)',
                        borderColor: '#8b5cf6',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Comparaci√≥n Te√≥rico vs Emp√≠rico
            const theoreticalW = results.map(r => {
                const th = r.theoretical || {};
                for (const [key, val] of Object.entries(th)) {
                    if (typeof val === 'object' && val !== null && val.W) return val.W;
                }
                return 0;
            });

            const empiricalW = results.map(r => r.empirical?.W_emp || 0);

            const ctxTheo = document.getElementById('comparisonTheoretical').getContext('2d');
            allCharts.comparisonTheoretical = new Chart(ctxTheo, {
                type: 'bar',
                data: {
                    labels: results.map(r => r.model_name),
                    datasets: [{
                        label: 'Te√≥rico',
                        data: theoreticalW,
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: '#3b82f6',
                        borderWidth: 2
                    }, {
                        label: 'Emp√≠rico',
                        data: empiricalW,
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderColor: '#10b981',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'W (Tiempo)' } }
                    }
                }
            });
        }

        function createComparisonChart(results) {
            const ctx = document.getElementById('comparisonChart');
            
            if (!ctx) {
                console.error('No se encontr√≥ el canvas comparisonChart');
                return;
            }
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }

            const labels = results.map(r => r.model_name);
            const rhoData = results.map(r => r.metrics?.rho || 0);
            const LData = results.map(r => r.metrics?.L || 0);
            const LqData = results.map(r => r.metrics?.Lq || 0);
            const WData = results.map(r => r.metrics?.W || 0);

            comparisonChart = new Chart(ctx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'œÅ (Utilizaci√≥n)',
                            data: rhoData,
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'L (Clientes en Sistema)',
                            data: LData,
                            backgroundColor: 'rgba(99, 102, 241, 0.8)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'Lq (Clientes en Cola)',
                            data: LqData,
                            backgroundColor: 'rgba(6, 182, 212, 0.8)',
                            borderColor: 'rgba(6, 182, 212, 1)',
                            borderWidth: 2
                        },
                        {
                            label: 'W (Tiempo en Sistema)',
                            data: WData,
                            backgroundColor: 'rgba(20, 184, 166, 0.8)',
                            borderColor: 'rgba(20, 184, 166, 1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                padding: 15
                            }
                        },
                        title: {
                            display: true,
                            text: 'Comparaci√≥n de M√©tricas entre Modelos',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            padding: 20
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function createMetricsTable(results) {
            const tbody = document.getElementById('metrics-table-body');
            tbody.innerHTML = '';

            const metricKeys = ['rho', 'L', 'Lq', 'W', 'Wq', 'lambda', 'mu'];
            const metricNames = {
                'rho': 'œÅ (Utilizaci√≥n)',
                'L': 'L (Sistema)',
                'Lq': 'Lq (Cola)',
                'W': 'W (T. Sistema)',
                'Wq': 'Wq (T. Cola)',
                'lambda': 'Œª (T. Llegada)',
                'mu': 'Œº (T. Servicio)'
            };

            metricKeys.forEach(key => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-blue-50 transition-colors';
                
                let html = `<td class="px-3 sm:px-6 py-3 sm:py-4 font-medium text-gray-900 text-xs sm:text-sm">${metricNames[key]}</td>`;
                
                results.forEach(model => {
                    const value = model.metrics[key];
                    html += `<td class="px-3 sm:px-6 py-3 sm:py-4 text-gray-700 text-xs sm:text-sm">${value !== undefined ? value.toFixed(4) : 'N/A'}</td>`;
                });
                
                row.innerHTML = html;
                tbody.appendChild(row);
            });
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('error-message').textContent = message;
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }
    </script>
</body>
</html>